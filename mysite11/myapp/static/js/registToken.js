window.ethereum.enable();
register_address = '0x0AbEafAE9333F7dC64959914f67765eDEe5FD05F';
register_abi = [{ "constant": true, "inputs": [], "name": "expiryLimit", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "_symbol", "type": "string" }], "name": "getDetails", "outputs": [{ "name": "", "type": "address" }, { "name": "", "type": "uint256" }, { "name": "", "type": "string" }, { "name": "", "type": "bytes32" }, { "name": "", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_newExpiry", "type": "uint256" }], "name": "changeExpiryLimit", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_stRegistry", "type": "address" }], "name": "setTokenRegistry", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "owner", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_symbol", "type": "string" }, { "name": "_owner", "type": "address" }, { "name": "_tokenName", "type": "string" }], "name": "checkValidity", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "strAddress", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_owner", "type": "address" }, { "name": "_symbol", "type": "string" }, { "name": "_tokenName", "type": "string" }, { "name": "_swarmHash", "type": "bytes32" }], "name": "registerTicker", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "newOwner", "type": "address" }], "name": "transferOwnership", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "_owner", "type": "address" }, { "indexed": false, "name": "_symbol", "type": "string" }, { "indexed": false, "name": "_name", "type": "string" }, { "indexed": false, "name": "_swarmHash", "type": "bytes32" }, { "indexed": false, "name": "_timestamp", "type": "uint256" }], "name": "LogRegisterTicker", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "_oldExpiry", "type": "uint256" }, { "indexed": false, "name": "_newExpiry", "type": "uint256" }], "name": "LogChangeExpiryLimit", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "previousOwner", "type": "address" }, { "indexed": true, "name": "newOwner", "type": "address" }], "name": "OwnershipTransferred", "type": "event" }];

registerInstance = web3.eth.contract(register_abi);
Register = registerInstance.at(register_address);

issue_address = '0x8e736d9caeb9eb9b7a766c196fbb01eb53344e81';
issue_abi = [{ "constant": false, "inputs": [{ "name": "_stVersionProxyAddress", "type": "address" }, { "name": "_version", "type": "bytes32" }], "name": "setProtocolVersion", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "tickerRegistry", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "protocolVersion", "outputs": [{ "name": "", "type": "bytes32" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "bytes32" }], "name": "protocolVersionST", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "owner", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "_securityToken", "type": "address" }], "name": "getSecurityTokenData", "outputs": [{ "name": "", "type": "string" }, { "name": "", "type": "address" }, { "name": "", "type": "bytes32" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "moduleRegistry", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_name", "type": "string" }, { "name": "_symbol", "type": "string" }, { "name": "_decimals", "type": "uint8" }, { "name": "_tokenDetails", "type": "bytes32" }], "name": "generateSecurityToken", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "newOwner", "type": "address" }], "name": "transferOwnership", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [{ "name": "_symbol", "type": "string" }], "name": "getSecurityTokenAddress", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "polyAddress", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "inputs": [{ "name": "_polyAddress", "type": "address" }, { "name": "_moduleRegistry", "type": "address" }, { "name": "_tickerRegistry", "type": "address" }, { "name": "_stVersionProxy", "type": "address" }], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "_ticker", "type": "string" }, { "indexed": false, "name": "_securityTokenAddress", "type": "address" }, { "indexed": false, "name": "_owner", "type": "address" }], "name": "LogNewSecurityToken", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "previousOwner", "type": "address" }, { "indexed": true, "name": "newOwner", "type": "address" }], "name": "OwnershipTransferred", "type": "event" }];

issueInstance = web3.eth.contract(issue_abi);
Issue = issueInstance.at(issue_address);

var tokenAddress;
var wlistAddress;

// 토큰 주소 리턴 함수 -> 이 주소 보고 관리자가 가서 abi 가져다가 DB에 넣어야 함
function getSecurityTokenAddress(symbol) {

    Issue.getSecurityTokenAddress(symbol, function (err, result) {
        // tokenAddress가 회사의 토큰 주소 DB에 들어가면 됨
        tokenAddress = result;
        //console.log("error log 2 : "+err);
    });
}

/*function getmodule(){

    Issue.getModule(2,0, function(err, result){
        // 화이트리스트 주소 저장
        wlistAddress = result[1];
        console.log("WhiteList's address is " + wlistAddress);
    });
}*/

// string, string, int, byte32
// leave tokenDetails empty
// 토큰 발행 함수
function generateSecurity(name, symbol, decimals, tokenDetails) {
    Issue.generateSecurityToken(name, symbol, decimals, tokenDetails, function (err, result) {
        //console.log("error log 1 : "+err);
        //location.href = "/";
        //getmodule();r
        console.log(err);
    });

    /*Issue.getSecurityTokenAddress(symbol, function(err, result){
        console.log("address is " + result[0]);

    });*/
}

// 회사를 화이트리스트에 등록
function addCompWlist(wlistaddress, compAddress) {
    wlistInstance = web3.eth.contract([{ "constant": false, "inputs": [], "name": "getInitFunction", "outputs": [{ "name": "", "type": "bytes4" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "WHITELIST", "outputs": [{ "name": "", "type": "bytes32" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "allowAllWhitelistTransfers", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_allowAllTransfers", "type": "bool" }], "name": "changeAllowAllTransfers", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_investor", "type": "address" }, { "name": "_fromTime", "type": "uint256" }, { "name": "_toTime", "type": "uint256" }], "name": "modifyWhitelist", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_investors", "type": "address[]" }, { "name": "_fromTimes", "type": "uint256[]" }, { "name": "_toTimes", "type": "uint256[]" }], "name": "modifyWhitelistMulti", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_allowAllWhitelistIssuances", "type": "bool" }], "name": "changeAllowAllWhitelistIssuances", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_allowAllWhitelistTransfers", "type": "bool" }], "name": "changeAllowAllWhitelistTransfers", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "FLAGS", "outputs": [{ "name": "", "type": "bytes32" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "", "type": "uint256" }], "name": "verifyTransfer", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "address" }], "name": "whitelist", "outputs": [{ "name": "fromTime", "type": "uint256" }, { "name": "toTime", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "allowAllTransfers", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "issuanceAddress", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "securityToken", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "getPermissions", "outputs": [{ "name": "", "type": "bytes32[]" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "factory", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_issuanceAddress", "type": "address" }], "name": "changeIssuanceAddress", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "allowAllWhitelistIssuances", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "inputs": [{ "name": "_securityToken", "type": "address" }], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "_issuanceAddress", "type": "address" }], "name": "LogChangeIssuanceAddress", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "_allowAllTransfers", "type": "bool" }], "name": "LogAllowAllTransfers", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "_allowAllWhitelistTransfers", "type": "bool" }], "name": "LogAllowAllWhitelistTransfers", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "_allowAllWhitelistIssuances", "type": "bool" }], "name": "LogAllowAllWhitelistIssuances", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "_investor", "type": "address" }, { "indexed": false, "name": "_dateAdded", "type": "uint256" }, { "indexed": false, "name": "_addedBy", "type": "address" }, { "indexed": false, "name": "_fromTime", "type": "uint256" }, { "indexed": false, "name": "_toTime", "type": "uint256" }], "name": "LogModifyWhitelist", "type": "event" }]);
    //wlistInstance = web3.eth.contract(abi); 
    Wlist = wlistInstance.at(wlistaddress);

    Wlist.modifyWhitelist(compAddress, 1, 1, function (err, result) {

    });
}

// 회사 계정으로 총량에 따라 토큰 발행 
function issueToken(contractaddress, compAddress, amount) {
    compContractInstance = web3.eth.contract([{ "constant": true, "inputs": [], "name": "name", "outputs": [{ "name": "", "type": "string" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_spender", "type": "address" }, { "name": "_value", "type": "uint256" }], "name": "approve", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "totalSupply", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_moduleType", "type": "uint8" }, { "name": "_moduleIndex", "type": "uint8" }], "name": "removeModule", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" }], "name": "transferFrom", "outputs": [{ "name": "success", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "decimals", "outputs": [{ "name": "", "type": "uint8" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "securityTokenVersion", "outputs": [{ "name": "", "type": "bytes32" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_investor", "type": "address" }, { "name": "_amount", "type": "uint256" }], "name": "mint", "outputs": [{ "name": "success", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [{ "name": "_moduleType", "type": "uint8" }, { "name": "_index", "type": "uint256" }], "name": "getModule", "outputs": [{ "name": "", "type": "bytes32" }, { "name": "", "type": "address" }, { "name": "", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "MAX_MODULES", "outputs": [{ "name": "", "type": "uint8" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_moduleType", "type": "uint8" }, { "name": "_moduleIndex", "type": "uint8" }, { "name": "_budget", "type": "uint256" }], "name": "changeModuleBudget", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "STO_KEY", "outputs": [{ "name": "", "type": "uint8" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_spender", "type": "address" }, { "name": "_subtractedValue", "type": "uint256" }], "name": "decreaseApproval", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "polyToken", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "_owner", "type": "address" }], "name": "balanceOf", "outputs": [{ "name": "balance", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "uint8" }, { "name": "", "type": "uint256" }], "name": "modules", "outputs": [{ "name": "name", "type": "bytes32" }, { "name": "moduleAddress", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "uint8" }], "name": "modulesLocked", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "_delegate", "type": "address" }, { "name": "_module", "type": "address" }, { "name": "_perm", "type": "bytes32" }], "name": "checkPermission", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "owner", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "TRANSFERMANAGER_KEY", "outputs": [{ "name": "", "type": "uint8" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "symbol", "outputs": [{ "name": "", "type": "string" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "_amount", "type": "uint256" }], "name": "verifyTransfer", "outputs": [{ "name": "success", "type": "bool" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "PERMISSIONMANAGER_KEY", "outputs": [{ "name": "", "type": "uint8" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" }], "name": "transfer", "outputs": [{ "name": "success", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_moduleFactory", "type": "address" }, { "name": "_data", "type": "bytes" }, { "name": "_maxCost", "type": "uint256" }, { "name": "_budget", "type": "uint256" }, { "name": "_locked", "type": "bool" }], "name": "addModule", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "moduleRegistry", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "tokenDetails", "outputs": [{ "name": "", "type": "bytes32" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "_spender", "type": "address" }, { "name": "_addedValue", "type": "uint256" }], "name": "increaseApproval", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [{ "name": "_owner", "type": "address" }, { "name": "_spender", "type": "address" }], "name": "allowance", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "newOwner", "type": "address" }], "name": "transferOwnership", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_amount", "type": "uint256" }], "name": "withdrawPoly", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "address" }], "name": "investorStatus", "outputs": [{ "name": "_status", "type": "uint8" }], "payable": false, "stateMutability": "pure", "type": "function" }, { "inputs": [{ "name": "_name", "type": "string" }, { "name": "_symbol", "type": "string" }, { "name": "_decimals", "type": "uint8" }, { "name": "_tokenDetails", "type": "bytes32" }, { "name": "_securityTokenRegistry", "type": "address" }], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "_type", "type": "uint8" }, { "indexed": false, "name": "_name", "type": "bytes32" }, { "indexed": false, "name": "_moduleFactory", "type": "address" }, { "indexed": false, "name": "_module", "type": "address" }, { "indexed": false, "name": "_moduleCost", "type": "uint256" }, { "indexed": false, "name": "_budget", "type": "uint256" }, { "indexed": false, "name": "_timestamp", "type": "uint256" }], "name": "LogModuleAdded", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "_type", "type": "uint8" }, { "indexed": false, "name": "_module", "type": "address" }, { "indexed": false, "name": "_timestamp", "type": "uint256" }], "name": "LogModuleRemoved", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "_moduleType", "type": "uint8" }, { "indexed": false, "name": "_module", "type": "address" }, { "indexed": false, "name": "_budget", "type": "uint256" }], "name": "LogModuleBudgetChanged", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "to", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" }], "name": "Mint", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "owner", "type": "address" }, { "indexed": true, "name": "spender", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" }], "name": "Approval", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "from", "type": "address" }, { "indexed": true, "name": "to", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" }], "name": "Transfer", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "previousOwner", "type": "address" }, { "indexed": true, "name": "newOwner", "type": "address" }], "name": "OwnershipTransferred", "type": "event" }]);
    CompContract = compContractInstance.at(contractaddress);

    CompContract.mint(compAddress, amount, function (err, result) {

    });
}